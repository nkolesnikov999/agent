# Chapter 1: Домашняя страница и виджеты


Добро пожаловать в руководство по Akvorado! В этой первой главе мы познакомимся со стартовым экраном приложения — Домашней страницей. Представьте ее как приборную панель вашего автомобиля или центр управления полетами: она дает вам быстрый обзор самого важного, что происходит в вашей сети прямо сейчас.

## Что такое Домашняя страница?

Домашняя страница Akvorado — это первое, что вы видите при входе в приложение. Ее основная задача — предоставить вам сводную информацию о сетевом трафике и состоянии системы сбора данных. Это достигается с помощью небольших информационных блоков, которые называются **виджетами**.

Каждый виджет — это как отдельный прибор на панели управления, показывающий конкретный показатель:

*   **Текущая скорость потоков:** Сколько сетевых сессий (потоков) регистрируется в секунду.
*   **Активные экспортеры:** Сколько устройств (маршрутизаторов, коммутаторов) отправляют данные в Akvorado.
*   **Последний полученный поток:** Детали самой последней зарегистрированной сетевой сессии.
*   **Топовые значения:** Кто генерирует больше всего трафика (по странам, сетям (AS), портам и т.д.).
*   **График трафика:** Общая картина изменения объема трафика за последнее время.

## Обзор интерфейса

Когда вы открываете Akvorado, вы видите примерно следующее:

![Пример домашней страницы Akvorado](https://raw.githubusercontent.com/akvorado/akvorado/master/docs/images/screenshot-homepage.png)
*(Примечание: Внешний вид может немного отличаться в зависимости от конфигурации)*

Страница организована в виде сетки. В центре и слева расположены основные виджеты: скорость потоков, количество экспортеров, топовые значения и общий график трафика. Справа обычно находится виджет с деталями последнего потока. Такая компоновка позволяет быстро оценить общую картину.

## Как устроены виджеты? Посмотрим на код!

Домашняя страница и ее виджеты созданы с использованием фреймворка Vue.js. Давайте заглянем "под капот".

### Основной компонент: `HomePage.vue`

Этот файл определяет общую структуру страницы и какие виджеты на ней будут отображаться.

```vue
<!-- console/frontend/src/views/HomePage.vue -->
<template>
  <div class="container mx-auto">
    <div class="grid grid-cols-1 gap-4 p-5 text-center xl:grid-cols-3">
      <!-- Сетка для размещения виджетов -->
      <div
        class="grid auto-rows-min grid-cols-2 gap-4 md:grid-cols-4 xl:col-span-2"
      >
        <!-- Описание Akvorado (или вашего проекта) -->
        <div class="col-span-2 flex flex-row">
          <!-- ... логотип и текст ... -->
        </div>

        <!-- Включение виджетов -->
        <WidgetFlowRate :refresh="refreshOften" />
        <WidgetExporters :refresh="refreshOccasionally" />
        <WidgetTop
          v-for="widget in topWidgets"
          :key="widget"
          :what="widget"
          :title="widgetTitle(widget)"
          :refresh="refreshOccasionally"
        />
        <WidgetGraph :refresh="refreshInfrequently" />
      </div>

      <!-- Отдельный виджет для последнего потока -->
      <WidgetLastFlow :refresh="refreshOften" />
    </div>
  </div>
</template>

<script lang="ts" setup>
// Импорт компонентов виджетов
import WidgetLastFlow from "./HomePage/WidgetLastFlow.vue";
import WidgetFlowRate from "./HomePage/WidgetFlowRate.vue";
// ... другие импорты ...
import { useInterval } from "@vueuse/core";

// Определяем интервалы обновления
const refreshOften = useInterval(10_000); // Каждые 10 секунд
const refreshOccasionally = useInterval(60_000); // Каждую минуту
const refreshInfrequently = useInterval(600_000); // Каждые 10 минут
// ... остальной скрипт ...
</script>
```

**Объяснение:**

*   `<template>`: Определяет HTML-структуру страницы. Используется сеточная разметка (`grid`) для расположения элементов.
*   `<WidgetFlowRate>`, `<WidgetExporters>`, `<WidgetTop>`, `<WidgetGraph>`, `<WidgetLastFlow>`: Это компоненты виджетов. Они вставляются в шаблон, как строительные блоки.
*   `:refresh="refreshOften"`: Это важная деталь! Мы передаем в каждый виджет специальное свойство (`prop`) под названием `refresh`. Значение этого свойства (`refreshOften`, `refreshOccasionally` и т.д.) определяет, как часто виджет будет запрашивать свежие данные.
*   `<script setup>`: Здесь происходит импорт необходимых компонентов и определение логики, включая интервалы обновления с помощью `useInterval`.

### Пример виджета: `WidgetFlowRate.vue` (Скорость потоков)

Этот виджет показывает, сколько потоков данных Akvorado обрабатывает в секунду.

```vue
<!-- console/frontend/src/views/HomePage/WidgetFlowRate.vue -->
<template>
  <div class="flex flex-col items-center justify-center">
    <!-- Отображаем вычисленное значение скорости -->
    <h2 class="title-font text-3xl font-medium ...">
      {{ rate }}
    </h2>
    <p class="leading-relaxed">Потоков/с</p> <!-- Заголовок на Русском для примера -->
  </div>
</template>

<script lang="ts" setup>
import { computed } from "vue";
import { useFetch } from "@vueuse/core";

// Принимаем 'refresh' от родительского компонента (HomePage.vue)
const props = defineProps<{ refresh?: number }>();

// Формируем URL для запроса к API, включая параметр 'refresh'
// Изменение 'refresh' вызовет повторный запрос данных
const url = computed(() => `/api/v0/console/widget/flow-rate?${props.refresh}`);

// Используем useFetch для получения данных с сервера
const { data } = useFetch(url, { refetch: true })
  .get()
  .json<{ rate: number } | { message: string }>(); // Ожидаем JSON с полем 'rate'

// Вычисляемое свойство для форматирования значения скорости
const rate = computed(() => {
  if (!data.value || "message" in data.value) {
    return "???"; // Показываем '???' если данных нет или ошибка
  }
  // Форматируем большие числа (K - тысячи, M - миллионы)
  if (data.value.rate > 1_500_000) {
    return (data.value.rate / 1_000_000).toFixed(1) + "M";
  }
  if (data.value.rate > 1_500) {
    return (data.value.rate / 1_000).toFixed(1) + "K";
  }
  return data.value.rate.toFixed(0); // Иначе показываем как есть
});
</script>
```

**Объяснение:**

1.  **Получение `refresh`:** Виджет получает интервал обновления (`props.refresh`) от `HomePage.vue`.
2.  **Формирование URL:** Создается URL для запроса к API Akvorado. Добавление `?${props.refresh}` к URL — это трюк: когда значение `refresh` меняется (каждые 10 секунд в данном случае), URL становится другим, что заставляет `useFetch` автоматически запросить данные заново.
3.  **Запрос данных (`useFetch`):** Функция `useFetch` из библиотеки `@vueuse/core` отправляет GET-запрос по указанному URL. Опция `{ refetch: true }` гарантирует, что запрос будет выполнен при изменении URL.
4.  **Обработка ответа:** Полученные данные (в формате JSON) сохраняются в `data`.
5.  **Форматирование (`computed rate`):** Свойство `rate` — это "вычисляемое" значение. Оно берет сырые данные (`data.value.rate`) и форматирует их для удобного отображения (например, `1500` превращается в `1.5K`). Если данных еще нет или произошла ошибка, отображается `"???"`.
6.  **Отображение (`<template>`):** Отформатированное значение `rate` вставляется в HTML-шаблон.

Другие виджеты (`WidgetExporters`, `WidgetGraph`, `WidgetTop`, `WidgetLastFlow`) работают по схожему принципу: получают параметр `refresh`, формируют свой уникальный URL для API, запрашивают данные с помощью `useFetch` и отображают их в своем специфическом формате (число, график, таблица, диаграмма).

*   `WidgetGraph.vue` и `WidgetTop.vue` используют библиотеку `echarts` (через `vue-echarts`) для рисования графиков и круговых диаграмм.
*   `WidgetLastFlow.vue` просто отображает полученные поля последнего потока в виде таблицы.

## Как это работает под капотом?

Давайте представим по шагам, что происходит, когда вы открываете Домашнюю страницу:

1.  **Загрузка:** Ваш браузер загружает компонент `HomePage.vue`.
2.  **Рендеринг Виджетов:** `HomePage.vue` начинает отображать вложенные компоненты виджетов (`WidgetFlowRate`, `WidgetGraph` и т.д.).
3.  **Запросы Данных:** Каждый компонент виджета немедленно инициирует запрос к своему API-эндпоинту на сервере Akvorado (например, `WidgetFlowRate` запрашивает `/api/v0/console/widget/flow-rate`). Эти запросы происходят *независимо* друг от друга.
4.  **Обработка на Сервере:** Сервер Akvorado (backend) получает каждый запрос, обращается к своей базе данных или кэшу для получения нужной информации (текущая скорость, список экспортеров, данные для графика и т.д.).
5.  **Ответ Сервера:** Сервер отправляет запрошенные данные обратно каждому виджету в формате JSON.
6.  **Отображение Данных:** Каждый виджет, получив свои данные, обновляет свое отображение на странице. Вместо "???" появляются актуальные цифры, графики и списки.
7.  **Периодическое Обновление:** Благодаря `useInterval` и параметру `refresh`, через заданные промежутки времени (10 секунд, 1 минута, 10 минут) шаги 3-6 повторяются для каждого виджета, поддерживая актуальность информации на Домашней странице.

Вот как это выглядит на диаграмме:

```mermaid
sequenceDiagram
    participant Пользователь
    participant Frontend (HomePage) as FE: Домашняя страница
    participant Frontend (Widget) as FW: Виджет (например, FlowRate)
    participant Backend API as API: Akvorado API
    participant Backend DB as DB: База данных/Кэш

    Пользователь->>FE: Домашняя страница: Открывает страницу
    FE->>FW: Виджет (например, FlowRate): Загружает компонент виджета
    FW->>API: Akvorado API: GET /api/v0/console/widget/flow-rate?{refresh_value}
    API->>DB: База данных/Кэш: Запрашивает данные о скорости потоков
    DB-->>API: Akvorado API: Возвращает данные
    API-->>FW: Виджет (например, FlowRate): Отправляет данные (JSON)
    FW->>FE: Домашняя страница: Обновляет отображение виджета
    FE-->>Пользователь: Домашняя страница: Показывает обновленную страницу с виджетами

    loop Каждые N секунд (зависит от виджета)
        Note over FW, API: Значение {refresh_value} изменяется
        FW->>API: Akvorado API: GET /api/v0/console/widget/flow-rate?{new_refresh_value}
        API->>DB: База данных/Кэш: Запрашивает актуальные данные
        DB-->>API: Akvorado API: Возвращает свежие данные
        API-->>FW: Виджет (например, FlowRate): Отправляет свежие данные (JSON)
        FW->>FE: Домашняя страница: Обновляет отображение виджета
    end
```

## Заключение

Мы познакомились с Домашней страницей Akvorado — вашим центром управления сетевым трафиком. Вы узнали, что она состоит из виджетов, каждый из которых показывает определенный аспект состояния сети или системы. Мы также немного заглянули в код, чтобы понять, как эти виджеты загружаются, получают данные с сервера и автоматически обновляются.

Домашняя страница — это лишь точка входа. В следующих главах мы изучим другие части интерфейса Akvorado.

**Далее:** В следующей главе, [Навигация и информация о пользователе](02_навигация_и_информация_о_пользователе_.md), мы рассмотрим основные элементы навигации по приложению и где найти информацию о текущем пользователе и конфигурации сервера.

---

Generated by [AI Codebase Knowledge Builder](https://github.com/The-Pocket/Tutorial-Codebase-Knowledge)